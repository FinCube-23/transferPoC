# Quick Schema Reference

## Organization Model

```javascript
{
    _id: ObjectId,              // Auto-generated by MongoDB
    org_id: Number,             // ✅ REQUIRED, UNIQUE, NOT AUTO-GENERATED
    wallet_address: String,     // ✅ REQUIRED, UNIQUE, NOT AUTO-GENERATED
    org_salt: String,           // Auto-generated (32-byte hex)
    createdAt: Date,            // Auto-generated
    updatedAt: Date             // Auto-generated
}
```

### Example Creation

```javascript
const org = new Organization({
    org_id: 1001,
    wallet_address: "0x1234567890123456789012345678901234567890",
})
await org.save()
```

## User Model

```javascript
{
    _id: ObjectId,              // Auto-generated by MongoDB
    user_id: Number,            // ✅ REQUIRED, UNIQUE, NOT AUTO-GENERATED
    batch_id: ObjectId,         // REQUIRED (foreign key)
    balance: Number,            // Default: 0, must be >= 0
    reference_number: String,   // Optional, unique when not null
    zkp_key: String,            // ✅ REQUIRED, UNIQUE
    createdAt: Date,            // Auto-generated
    updatedAt: Date             // Auto-generated
}
```

### Example Creation

```javascript
const user = new User({
    user_id: 2001,
    batch_id: batchId,
    balance: 100,
    reference_number: "REF-001", // Optional
    zkp_key: "zkp_key_001",
})
await user.save()
```

## Key Changes from Previous Schema

### Organization

-   ❌ Removed: `reference_key` (was auto-generated UUID)
-   ✅ Added: `org_id` (Number, required, unique, manual)
-   ✅ Added: `wallet_address` (String, required, unique, manual)

### User

-   ✅ Added: `user_id` (Number, required, unique, manual)
-   ✅ Added: `zkp_key` (String, required, unique)

## Validation Rules

### Organization

-   `org_id` must be unique across all organizations
-   `wallet_address` must be unique across all organizations
-   `org_salt` is auto-generated if not provided

### User

-   `user_id` must be unique across all users
-   `zkp_key` must be unique across all users
-   `balance` must be >= 0
-   `reference_number` must be unique when not null (sparse index)

## Common Errors

### Missing Required Fields

```javascript
// ❌ WRONG - Missing required fields
const org = new Organization({})

// ✅ CORRECT
const org = new Organization({
    org_id: 1001,
    wallet_address: "0x...",
})
```

### Duplicate Values

```javascript
// ❌ WRONG - Duplicate org_id
const org1 = new Organization({ org_id: 1001, wallet_address: "0x..." })
const org2 = new Organization({ org_id: 1001, wallet_address: "0xabc..." })
// Will fail on save!

// ✅ CORRECT - Unique org_id
const org1 = new Organization({ org_id: 1001, wallet_address: "0x..." })
const org2 = new Organization({ org_id: 1002, wallet_address: "0xabc..." })
```

## Testing

Run the test suite to verify your changes:

```bash
node test-models.js
```

Check database indexes:

```bash
node check-indexes.js
```

Fix indexes if needed:

```bash
node fix-indexes.js
```
