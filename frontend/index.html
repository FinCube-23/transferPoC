<div id="app" style="font-family: 'Inter', system-ui, sans-serif; min-height: 100vh; width: 100vw; display: flex; flex-direction: column; justify-content: flex-start; align-items: center; padding: 0; margin: 0; box-sizing: border-box; position: relative;">

  <!-- Star background -->
  <div class="stars-background">
    <div class="stars"></div>
    <div class="stars2"></div>
    <div class="stars3"></div>
    <div class="nebula nebula-1"></div>
    <div class="nebula nebula-2"></div>
    <div class="cosmic-fog"></div>
    
    <!-- Glowing stars -->
    <div class="stars-glowing">
      <div class="glowing-star"></div>
      <div class="glowing-star"></div>
      <div class="glowing-star"></div>
      <div class="glowing-star"></div>
      <div class="glowing-star"></div>
    </div>
    
    <!-- Shooting stars -->
    <div class="shooting-star"></div>
    <div class="shooting-star"></div>
    <div class="shooting-star"></div>
  </div>

  <!-- Header with title and subtitle -->
  <header class="app-header signin-hide" style="display: flex; justify-content: space-between; align-items: center; width: 100%; padding: 0.5rem 1.5rem; box-sizing: border-box; margin-bottom: 0.25rem; border-bottom: none;">
    <!-- Left: FinCube Logo and Title -->
    <div style="display: flex; align-items: center; gap: 1rem;">
      <div class="app-title" style="display: flex; flex-direction: column;">
        <div class="app-logo" style="display: flex; align-items: center; gap: 0.5rem;">
          <div class="app-logo-icon" style="display: flex; align-items: center; justify-content: center; width: 2.2rem; height: 2.2rem; background: linear-gradient(135deg, #10b981 0%, #06b6d4 100%); border-radius: 50%; padding: 0.5rem; box-shadow: 0 8px 20px rgba(16,185,129,0.25);">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2">
              <path d="M12 2L2 7l10 5 10-5-10-5zM2 17l10 5 10-5M2 12l10 5 10-5"></path>
            </svg>
          </div>
          <h1 class="gradient-text" style="font-size: 1.8rem; margin: 0; background: linear-gradient(135deg, #10b981 0%, #06b6d4 100%); -webkit-background-clip: text; background-clip: text; color: transparent; font-weight: 800; letter-spacing: -0.02em;">FinCube</h1>
        </div>
      </div>
      
      <!-- Sign Out Button -->
      <button id="sign-out" style="display:none; padding: 0.5rem 1rem; background: #ef4444; color: #fff; border: none; border-radius: 0.5rem; font-weight: 600; cursor: pointer; box-shadow: 0 4px 12px rgba(239,68,68,0.25);">Sign Out</button>
    </div>
    
    <!-- Right: Wallet Controls -->
    <div style="display:flex; gap: 1rem; align-items: center;">
      <div>
        <button id="sign-in-top" style="display:none; padding: 0.6rem 1.2rem; background: linear-gradient(135deg, #10b981 0%, #06b6d4 100%); color: #fff; border: none; border-radius: 0.6rem; font-weight: 600; cursor: pointer; box-shadow: 0 4px 12px rgba(16,185,129,0.25);">Sign In</button>
      </div>
      <div style="display:flex; gap: 0.75rem; align-items: center;">
        <div id="wallet-status" class="badge badge-primary" style="display: inline-flex; align-items: center; gap: 0.4rem; padding: 0.4rem 0.8rem; background: rgba(16,185,129,0.1); border-radius: 0.6rem; color: #10b981; font-weight: 500;">
          <svg width='18' height='18' viewBox='0 0 24 24' fill='none'>
            <circle cx='12' cy='12' r='10' fill='#06b6d4'/>
            <path d='M12 8v4M12 16h.01' stroke='#fff' stroke-width='2' stroke-linecap='round'/>
          </svg>
          <span style='font-family: monospace;'>Connect your wallet please</span>
        </div>
        <button id="connect-wallet" style="padding: 0.6rem 1.2rem; background: linear-gradient(135deg, #10b981 0%, #06b6d4 100%); color: #fff; border: none; border-radius: 0.6rem; font-weight: 600; cursor: pointer; box-shadow: 0 4px 12px rgba(16,185,129,0.25);">Connect Wallet</button>
      </div>
    </div>
  </header>

  <!-- Auth Modal -->
  <div id="auth-modal" style="display:none; position: fixed; inset: 0; background: rgba(15,23,42,0.45); backdrop-filter: blur(4px); -webkit-backdrop-filter: blur(4px); align-items: center; justify-content: center; padding: 1rem; z-index: 50;">
    <div style="width: 100%; max-width: 420px; background: #ffffff; border-radius: 0.9rem; box-shadow: 0 24px 60px rgba(2,6,23,0.35); overflow: hidden; position: relative;">
      <button id="auth-close" aria-label="Close" style="position:absolute; top: 10px; right: 10px; background: transparent; border: none; cursor: pointer; padding: 6px; border-radius: 8px; color: #334155;">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none">
          <path d="M6 6l12 12M18 6L6 18" stroke="#334155" stroke-width="2" stroke-linecap="round"/>
        </svg>
      </button>

      <div style="padding: 0.8rem 1rem 0.5rem; border-bottom: 1px solid #e5e7eb; display:flex; gap:0.4rem;">
        <button id="tab-login" data-tab="login" style="flex:1; padding: 0.6rem; border: none; background: #ecfdf5; color:#10b981; border-radius: 0.6rem; font-weight: 700; cursor: pointer;">Login</button>
        <button id="tab-register" data-tab="register" style="flex:1; padding: 0.6rem; border: none; background: transparent; color:#334155; border-radius: 0.6rem; font-weight: 700; cursor: pointer;">Register</button>
      </div>

      <div style="padding: 0.8rem 1rem;">
        <!-- Login Form -->
        <form id="form-login" novalidate style="display:block; display:flex; flex-direction: column; gap: 0.6rem;">
          <div style="display:flex; flex-direction: column; gap:0.2rem;">
            <label for="login-email" style="font-weight:700; color:#0f172a; font-size:0.95rem;">Email</label>
            <input id="login-email" type="email" placeholder="you@example.com" required 
                   style="width:100%; padding:0.8rem 0.9rem; border:2px solid #e2e8f0; border-radius:0.7rem; font-size:1rem; background:#fff; outline:none; box-sizing:border-box;"/>
            <small id="login-email-err" style="color:#ef4444; display:none;">Enter a valid email.</small>
          </div>
          <div style="display:flex; flex-direction: column; gap:0.2rem;">
            <label for="login-password" style="font-weight:700; color:#0f172a; font-size:0.95rem;">Password</label>
            <input id="login-password" type="password" placeholder="Your password" required minlength="6"
                   style="width:100%; padding:0.8rem 0.9rem; border:2px solid #e2e8f0; border-radius:0.7rem; font-size:1rem; background:#fff; outline:none; box-sizing:border-box;"/>
            <small id="login-password-err" style="color:#ef4444; display:none;">Password must be at least 6 characters.</small>
          </div>
          <button type="submit" style="margin-top:0.2rem; padding:0.8rem 1rem; background: linear-gradient(135deg, #10b981 0%, #06b6d4 100%); color:#fff; border:none; border-radius:0.7rem; font-weight:800; cursor:pointer; box-shadow:0 10px 22px rgba(16,185,129,0.35);">Sign In</button>
        </form>

        <!-- Register Form -->
        <form id="form-register" novalidate style="display:none; display:flex; flex-direction: column; gap: 0.6rem;">
          <div style="display:flex; gap:0.5rem;">
            <div style="flex:1; display:flex; flex-direction: column; gap:0.2rem;">
              <label for="reg-first" style="font-weight:700; color:#0f172a; font-size:0.95rem;">First name</label>
              <input id="reg-first" type="text" placeholder="John" required 
                     style="width:100%; padding:0.8rem 0.9rem; border:2px solid #e2e8f0; border-radius:0.7rem; font-size:1rem; background:#fff; outline:none; box-sizing:border-box;"/>
              <small id="reg-first-err" style="color:#ef4444; display:none;">First name is required.</small>
            </div>
            <div style="flex:1; display:flex; flex-direction: column; gap:0.35rem;">
              <label for="reg-last" style="font-weight:700; color:#0f172a; font-size:0.95rem;">Last name</label>
              <input id="reg-last" type="text" placeholder="Doe" required 
                     style="width:100%; padding:0.9rem 1rem; border:2px solid #e2e8f0; border-radius:0.7rem; font-size:1rem; background:#fff; outline:none; box-sizing:border-box;"/>
              <small id="reg-last-err" style="color:#ef4444; display:none;">Last name is required.</small>
            </div>
          </div>
          <div style="display:flex; flex-direction: column; gap:0.35rem;">
            <label for="reg-email" style="font-weight:700; color:#0f172a; font-size:0.95rem;">Email</label>
            <input id="reg-email" type="email" placeholder="you@example.com" required 
                   style="width:100%; padding:0.9rem 1rem; border:2px solid #e2e8f0; border-radius:0.7rem; font-size:1rem; background:#fff; outline:none; box-sizing:border-box;"/>
            <small id="reg-email-err" style="color:#ef4444; display:none;">Enter a valid email.</small>
          </div>
          <div style="display:flex; flex-direction: column; gap:0.35rem;">
            <label for="reg-phone" style="font-weight:700; color:#0f172a; font-size:0.95rem;">Contact number</label>
            <input id="reg-phone" type="tel" placeholder="+8801712345678" required 
                   style="width:100%; padding:0.9rem 1rem; border:2px solid #e2e8f0; border-radius:0.7rem; font-size:1rem; background:#fff; outline:none; box-sizing:border-box;"/>
            <small id="reg-phone-err" style="color:#ef4444; display:none;">Enter a valid Bangladeshi number (e.g., +8801712345678).</small>
          </div>
          <div style="display:flex; flex-direction: column; gap:0.35rem;">
            <label for="reg-password" style="font-weight:700; color:#0f172a; font-size:0.95rem;">Password</label>
            <input id="reg-password" type="password" placeholder="Create a password" required minlength="6"
                   style="width:100%; padding:0.9rem 1rem; border:2px solid #e2e8f0; border-radius:0.7rem; font-size:1rem; background:#fff; outline:none; box-sizing:border-box;"/>
          </div>
          <div style="display:flex; flex-direction: column; gap:0.35rem;">
            <label for="reg-confirm" style="font-weight:700; color:#0f172a; font-size:0.95rem;">Confirm Password</label>
            <input id="reg-confirm" type="password" placeholder="Repeat password" required minlength="6"
                   style="width:100%; padding:0.9rem 1rem; border:2px solid #e2e8f0; border-radius:0.7rem; font-size:1rem; background:#fff; outline:none; box-sizing:border-box;"/>
            <small id="reg-password-err" style="color:#ef4444; display:none;">Passwords must match and be at least 6 characters.</small>
          </div>
          <button type="submit" style="margin-top:0.2rem; padding:0.9rem 1.1rem; background: linear-gradient(135deg, #10b981 0%, #06b6d4 100%); color:#fff; border:none; border-radius:0.7rem; font-weight:800; cursor:pointer; box-shadow:0 10px 22px rgba(16,185,129,0.35);">Create Account</button>
        </form>
      </div>
    </div>
  </div>

  <style>
    @keyframes spin { to { transform: rotate(360deg); } }
    
    /* Input focus states */
    input:focus {
      border-color: #10b981 !important;
      box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1) !important;
      background: rgba(255,255,255,0.95) !important;
    }
    
    /* Button hover effect */
    button[type="submit"]:hover > div {
      opacity: 1 !important;
    }
    
    button[type="submit"]:hover {
      transform: translateY(-1px);
      box-shadow: 0 12px 28px rgba(16,185,129,0.5) !important;
    }
    
    button[type="submit"]:active {
      transform: translateY(0);
    }
  </style>

  <style>
    /* Auth Modal small enhancements */
    #auth-modal button:focus, #auth-modal input:focus { outline: none; }
    #auth-modal input:focus { border-color: #10b981; box-shadow: 0 0 0 3px rgba(16,185,129,0.12); }
    #auth-modal [data-active="true"] { background: linear-gradient(135deg, #10b981 0%, #06b6d4 100%) !important; color:#fff !important; }
    #auth-modal label { user-select: none; }
  </style>

  <!-- Centered Sign In Page (initial state) -->
  <!-- Hidden by default to avoid a flash on page load; main.ts will show it when appropriate -->
  <div id="signin-center" class="signin-landing" style="display: none;">
    <div class="signin-content-seamless">
      <!-- Logo and Branding -->
      <div class="signin-logo">
        <div class="app-logo-icon-large">
          <svg width="60" height="60" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2">
            <path d="M12 2L2 7l10 5 10-5-10-5zM2 17l10 5 10-5M2 12l10 5 10-5"></path>
          </svg>
        </div>
        
        <!-- FINCUBE with three feature icons -->
        <div class="fincube-branding">
          <h1 class="signin-title">FINCUBE</h1>
          <div class="feature-icons">
            <div class="feature-item">
              <div class="feature-icon seamless-icon" title="Seamless">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M13 2L3 14h9l-1 8 10-12h-9l1-8z"/>
                </svg>
              </div>
              <div class="feature-text">
                <span class="feature-title seamless-text">Seamless</span>
                <span class="feature-description">Effortless transactions</span>
              </div>
            </div>
            <div class="feature-item">
              <div class="feature-icon lightning-icon" title="Lightning">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <polyline points="22,12 18,12 15,21 9,9 6,12 2,12"/>
                </svg>
              </div>
              <div class="feature-text">
                <span class="feature-title lightning-text">Lightning</span>
                <span class="feature-description">Ultra-fast speed</span>
              </div>
            </div>
            <div class="feature-item">
              <div class="feature-icon transfer-icon" title="Transfer">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M7 17L17 7M17 7H7M17 7V17"/>
                </svg>
              </div>
              <div class="feature-text">
                <span class="feature-title transfer-text">Transfer</span>
                <span class="feature-description">Secure payments</span>
              </div>
            </div>
          </div>
        </div>
      </div>
      
      <!-- Sign In Button -->
      <button id="sign-in" class="signin-button-seamless">Sign In</button>
    </div>
  </div>

  <!-- Token Balances (Auth Only) -->
  <div id="auth-section" style="display:none; margin-top: 0.3rem; margin-left: auto; margin-right: auto; flex-direction: column; align-items: center; width: 100%; max-width: 900px; gap: 0.25rem;">
  <div style="display:inline-flex; align-items:center; gap:0.5rem; padding:0.45rem 0.9rem; border-radius:1rem; background: linear-gradient(135deg, rgba(6,182,212,0.06), rgba(16,185,129,0.04)); border: 1px solid rgba(6,182,212,0.08); box-shadow: 0 10px 30px rgba(6,182,212,0.12), inset 0 1px 0 rgba(255,255,255,0.03); backdrop-filter: blur(6px); -webkit-backdrop-filter: blur(6px);">
      <svg width="24" height="24" viewBox="0 0 24 24" fill="none" aria-hidden="true">
        <defs>
          <linearGradient id="wlgrad" x1="0" y1="0" x2="24" y2="24" gradientUnits="userSpaceOnUse">
            <stop offset="0%" stop-color="#10b981"/>
            <stop offset="100%" stop-color="#06b6d4"/>
          </linearGradient>
        </defs>
        <!-- Wallet body -->
        <rect x="2" y="5" width="16" height="12" rx="2.5" fill="url(#wlgrad)" opacity="0.1"/>
        <rect x="2" y="5" width="16" height="12" rx="2.5" stroke="url(#wlgrad)" stroke-width="1.8"/>
        <!-- Wallet flap -->
        <path d="M2 7.5h16" stroke="url(#wlgrad)" stroke-width="1.8" stroke-linecap="round"/>
        <!-- Cards inside wallet -->
        <rect x="4" y="9" width="8" height="5" rx="0.8" fill="url(#wlgrad)" opacity="0.3"/>
        <rect x="5" y="10" width="6" height="3" rx="0.5" fill="url(#wlgrad)" opacity="0.5"/>
        <!-- Wallet clasp -->
        <rect x="18" y="8" width="4" height="6" rx="1" fill="url(#wlgrad)" opacity="0.2"/>
        <rect x="18" y="8" width="4" height="6" rx="1" stroke="url(#wlgrad)" stroke-width="1.6"/>
        <circle cx="20" cy="11" r="0.8" fill="#10b981"/>
      </svg>
      <span style="font-weight:900; font-size:1.35em; letter-spacing:0.03em; background: linear-gradient(90deg,#0f172a 0%, #10b981 50%, #06b6d4 100%); -webkit-background-clip:text; background-clip:text; color: transparent;">Wallets</span>
    </div>
    <div style="display: flex; justify-content: center; gap: 0.3rem; flex-wrap: wrap; width: 100%; margin-top: 0.2rem;">
    <!-- USD -->
    <div style="flex: 1 1 180px; max-width: 220px; background: #f8fafc; border: 1px solid rgba(16, 185, 129, 0.3); border-radius: 1rem; text-align: center; padding: 0.7rem; box-shadow: 0 4px 14px rgba(6, 182, 212, 0.15); transition: transform 0.2s;">
      <div style="background: rgba(16, 185, 129, 0.1); width: 40px; height: 40px; border-radius: 50%; display: flex; align-items: center; justify-content: center; margin: 0 auto 0.3rem;">
        <svg width="28" height="28" viewBox="0 0 24 24" fill="none" style="margin-bottom: 0;" aria-label="USD">
          <circle cx="12" cy="12" r="12" fill="#10b981"/>
          <path d="M13.75 7.75c0-.966-.784-1.75-1.75-1.75s-1.75.784-1.75 1.75c0 .966.784 1.75 1.75 1.75h1c1.243 0 2.25 1.007 2.25 2.25s-1.007 2.25-2.25 2.25h-2.5" stroke="#fff" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"/>
          <path d="M12 5v14" stroke="#fff" stroke-width="1.6" stroke-linecap="round"/>
        </svg>
      </div>
      <div style="font-weight: 700; color: #111827; font-size: 1.05em; margin-bottom: 0.3rem;">USD Balance</div>
      <div id="usd-balance">0</div>
    </div>
    <!-- ETH -->
    <div style="flex: 1 1 180px; max-width: 220px; background: #f8fafc; border: 1px solid rgba(16, 185, 129, 0.3); border-radius: 1rem; text-align: center; padding: 0.7rem; box-shadow: 0 4px 14px rgba(6, 182, 212, 0.15); transition: transform 0.2s;">
      <div style="background: rgba(6, 182, 212, 0.1); width: 40px; height: 40px; border-radius: 50%; display: flex; align-items: center; justify-content: center; margin: 0 auto 0.3rem;">
        <img src="https://img.icons8.com/fluency/48/ethereum.png" alt="ETH" style="width: 28px; height: 28px;">
      </div>
      <div style="font-weight: 700; color: #111827; font-size: 1.05em; margin-bottom: 0.3rem;">ETH Balance</div>
      <div id="eth-balance">0</div>
    </div>
    <!-- USDC -->
    <div style="flex: 1 1 180px; max-width: 220px; background: #f8fafc; border: 1px solid rgba(16, 185, 129, 0.3); border-radius: 1rem; text-align: center; padding: 0.7rem; box-shadow: 0 4px 14px rgba(6, 182, 212, 0.15); transition: transform 0.2s;">
      <div style="background: rgba(39, 117, 202, 0.1); width: 40px; height: 40px; border-radius: 50%; display: flex; align-items: center; justify-content: center; margin: 0 auto 0.3rem;">
        <svg width="28" height="28" viewBox="0 0 24 24" fill="none" aria-label="USDC">
          <circle cx="12" cy="12" r="12" fill="#2775CA"/>
          <path d="M9.5 8.5c-.8.4-1.3 1.1-1.3 1.9 0 1.1.8 1.9 2.4 2.2 1.5.3 2 .7 2 .1 0-.5-.4-.8-1.4-1.1l-1.1-.3c-1.9-.4-2.9-1.4-2.9-2.9 0-1.3.9-2.3 2.3-2.7V5h1.3v1.3c1 .2 1.8.8 2.1 1.6l-1.2.5c-.2-.6-.7-1-1.5-1.2-.8-.2-1.4 0-1.7.3zM13.2 15.5c.9-.3 1.5-1 1.5-2 0-1.1-.8-1.9-2.5-2.2-1.3-.3-1.8-.5-1.8-.1 0 .4.4.7 1.3.9l1.2.3c2.1.5 3.1 1.5 3.1 3 0 1.4-1 2.5-2.7 2.8V19h-1.3v-1.3c-1.1-.2-2-.8-2.4-1.7l1.3-.5c.2.7.8 1.1 1.6 1.3.8.2 1.4 0 1.7-.3z" fill="#fff"/>
          <path d="M7.2 18.3A7.2 7.2 0 1 1 18.3 7.2 7.2 7.2 0 0 1 7.2 18.3Zm0-1.4a5.8 5.8 0 1 0 0-11.6 5.8 5.8 0 0 0 0 11.6Z" fill="#fff"/>
        </svg>
      </div>
      <div style="font-weight: 700; color: #111827; font-size: 1.05em; margin-bottom: 0.3rem;">USDC Balance</div>
      <div id="usdc-balance">0</div>
    </div>
    </div>
  </div>

  <!-- Token Transfer Form (Auth Only) -->
  <form id="transfer-form" style="display:none; margin-top: 0.75rem; margin-left: auto; margin-right: auto; flex-direction: column; gap: 0.8rem; width: 100%; max-width: 420px;">
    <div style="position: relative;">
      <input type="text" name="address" placeholder="Recipient Address" required
             style="width: 100%; padding: 1rem 1.2rem; border: 2px solid #e2e8f0; border-radius: 0.75rem; font-size: 1rem; font-weight: 500; outline: none; background: rgba(255,255,255,0.9); transition: all 0.2s ease; box-sizing: border-box;"/>
      <div style="position: absolute; top: 50%; right: 1rem; transform: translateY(-50%); pointer-events: none;">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none">
          <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0Z" stroke="#94a3b8" stroke-width="1.5"/>
          <circle cx="12" cy="10" r="3" stroke="#94a3b8" stroke-width="1.5"/>
        </svg>
      </div>
    </div>
    <div style="position: relative;">
      <input type="text" name="amount" placeholder="Amount" inputmode="decimal" required
             style="width: 100%; padding: 1rem 1.2rem; border: 2px solid #e2e8f0; border-radius: 0.75rem; font-size: 1rem; font-weight: 500; outline: none; background: rgba(255,255,255,0.9); transition: all 0.2s ease; box-sizing: border-box;"/>
      <div style="position: absolute; top: 50%; right: 1rem; transform: translateY(-50%); pointer-events: none;">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" aria-label="ETH">
          <path d="M12 2l6 9-6 3-6-3 6-9z" fill="#94a3b8" opacity="0.95"/>
          <path d="M12 14l6-3-6 11-6-11 6 3z" fill="#94a3b8" opacity="0.7"/>
        </svg>
      </div>
    </div>
    <button type="submit" 
            style="width: 100%; padding: 1rem 1.5rem; background: linear-gradient(135deg, #10b981 0%, #06b6d4 100%); color: #fff; border: none; border-radius: 0.75rem; font-weight: 700; font-size: 1.1rem; cursor: pointer; box-shadow: 0 8px 20px rgba(16,185,129,0.4); transition: all 0.3s ease; position: relative; overflow: hidden; display: flex; align-items: center; justify-content: center; gap: 0.5rem;">
      <svg width="20" height="20" viewBox="0 0 24 24" fill="none" style="position: relative; z-index: 1;">
        <path d="M3 12h18m-9-9l9 9-9 9" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
      </svg>
      <span style="position: relative; z-index: 1;">Transfer</span>
      <div style="position: absolute; inset: 0; background: linear-gradient(135deg, #06b6d4 0%, #0891b2 100%); opacity: 0; transition: opacity 0.3s ease;"></div>
    </button>
  </form>

  <!-- Recent Transactions Dashboard - Hidden on front page -->
  <div id="recent-transactions" style="max-width: 900px; width: calc(100% - 2rem); padding: 1rem 1.5rem; box-sizing: border-box; margin: 2rem auto 0; display: none;">
    <div class="transactions-header">
      <div class="transactions-title">
        <svg width="22" height="22" viewBox="0 0 24 24" fill="none"><path d="M12 6v6l4 2" stroke="#06b6d4" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/><circle cx="12" cy="12" r="10" stroke="#06b6d4" stroke-width="1.5" fill="none"/></svg>
        <span>Recent Transactions</span>
      </div>
      <div class="transactions-subtitle">Latest 10</div>
    </div>
    <div class="transactions-table">
      <div class="transactions-table-header">
        <div>Sender</div>
        <div>Recipient</div>
        <div style="text-align:right;">Amount</div>
        <div style="text-align:right;">Date</div>
      </div>
      <div id="tx-rows" class="transactions-rows">
        <!-- Rows injected here -->
      </div>
    </div>
  </div>

  <!-- Authentication Loading Overlay -->
  <div id="auth-loading" class="auth-loading" style="display: none;">
    <div class="auth-loading-content">
      <div class="auth-spinner"></div>
      <div id="auth-loading-text" class="auth-loading-text">Authenticating...</div>
    </div>
  </div>

</div>
<script type="module" src="/src/main.ts"></script>
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<script src="https://cdn.jsdelivr.net/npm/libphonenumber-js@1.10.53/bundle/libphonenumber-js.min.js"></script>
<script>
  // Auth modal behaviors
  const API_BASE = '';
  async function parseApiError(res) {
    try {
      const data = await res.json();
      if (data?.message) return data.message;
      if (data?.detail) return data.detail;
      if (Array.isArray(data?.errors)) return data.errors.join('\n');
      if (typeof data === 'string') return data;
      return `Request failed with status ${res.status}`;
    } catch (_) {
      try { const text = await res.text(); return text || `Request failed with status ${res.status}`; } catch { return `Request failed with status ${res.status}`; }
    }
  }
  function getCookie(name) {
    const value = `; ${document.cookie}`;
    const parts = value.split(`; ${name}=`);
    if (parts.length === 2) return parts.pop().split(';').shift();
    return '';
  }
  function getCsrfToken() {
    return getCookie('csrftoken') || getCookie('CSRF-TOKEN') || getCookie('XSRF-TOKEN') || '';
  }
  const authModal = document.getElementById('auth-modal');
  const btnSignInTop = document.getElementById('sign-in-top');
  const btnSignInCenter = document.getElementById('sign-in');
  const btnClose = document.getElementById('auth-close');
  const tabLogin = document.getElementById('tab-login');
  const tabRegister = document.getElementById('tab-register');
  const formLogin = document.getElementById('form-login');
  const formRegister = document.getElementById('form-register');

  function openAuthModal(defaultTab = 'login') {
    if (!authModal) return;
    authModal.style.display = 'flex';
    switchTab(defaultTab);
  }

  function closeAuthModal() {
    if (!authModal) return;
    authModal.style.display = 'none';
  }

  function switchTab(tab) {
    const isLogin = tab === 'login';
    if (formLogin && formRegister && tabLogin && tabRegister) {
      formLogin.style.display = isLogin ? 'flex' : 'none';
      formRegister.style.display = isLogin ? 'none' : 'flex';
      tabLogin.setAttribute('data-active', isLogin ? 'true' : 'false');
      tabRegister.setAttribute('data-active', !isLogin ? 'true' : 'false');
    }
  }

  btnSignInTop && btnSignInTop.addEventListener('click', () => openAuthModal('login'));
  btnSignInCenter && btnSignInCenter.addEventListener('click', () => openAuthModal('login'));
  btnClose && btnClose.addEventListener('click', closeAuthModal);
  authModal && authModal.addEventListener('click', (e) => {
    if (e.target === authModal) closeAuthModal();
  });

  // Restore frontend-only auth persistence after the app's initial DOMContentLoaded setup
  document.addEventListener('DOMContentLoaded', () => {
    try {
      if (localStorage.getItem('fincube_auth')) {
        (window).authSetSignedIn && (window).authSetSignedIn(true);
        // reinforcement: call again after short delays to override any other initialization
        setTimeout(() => { (window).authSetSignedIn && (window).authSetSignedIn(true); }, 100);
        setTimeout(() => { (window).authSetSignedIn && (window).authSetSignedIn(true); }, 500);
      }
    } catch (e) { /* ignore */ }

    // Ensure sign-out clears the persistence flag
    const signOutBtnPersist = document.getElementById('sign-out');
    signOutBtnPersist && signOutBtnPersist.addEventListener('click', () => {
      try { localStorage.removeItem('fincube_auth'); } catch (e) {}
    });
  });

  tabLogin && tabLogin.addEventListener('click', () => switchTab('login'));
  tabRegister && tabRegister.addEventListener('click', () => switchTab('register'));

  // Minimal validation hints
  function show(el) { if (el) el.style.display = 'block'; }
  function hide(el) { if (el) el.style.display = 'none'; }

  formLogin && formLogin.addEventListener('submit', (e) => {
    e.preventDefault();
    const email = document.getElementById('login-email');
    const pass = document.getElementById('login-password');
    const emailErr = document.getElementById('login-email-err');
    const passErr = document.getElementById('login-password-err');
    let ok = true;
    if (email && !/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email.value)) { show(emailErr); ok = false; } else { hide(emailErr); }
    if (pass && pass.value.length < 6) { show(passErr); ok = false; } else { hide(passErr); }
    if (ok) {
      // Call backend login
      const loginPayload = {
        email: String(email.value || '').trim(),
        password: String(pass.value || '')
      };
      
      // Get the submit button and show loading state
      const submitBtn = e.target.querySelector('button[type="submit"]');
      const authLoading = document.getElementById('auth-loading');
      
      // Update button text and disable it
      if (submitBtn) {
        submitBtn.disabled = true;
        submitBtn.style.opacity = '0.7';
        submitBtn.textContent = 'Authenticating...';
      }
      
      // Show beautiful loading overlay
      if (authLoading) authLoading.style.display = 'flex';
      
      // Call backend login
      (async () => {
        try {
          const resp = await fetch(`${API_BASE}/api/users/login`, {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
              'Accept': 'application/json',
              'X-CSRFTOKEN': getCsrfToken()
            },
            credentials: 'include',
            body: JSON.stringify(loginPayload)
          });

          // Reset loading UI
          if (authLoading) authLoading.style.display = 'none';
          if (submitBtn) {
            submitBtn.disabled = false;
            submitBtn.style.opacity = '1';
            submitBtn.textContent = 'Sign In';
          }

          if (!resp.ok) {
            const msg = await parseApiError(resp);
            // Only show "invalid" message for auth failures, otherwise show backend message
            alert(msg || 'Login failed');
            return;
          }

          // success
          try { localStorage.setItem('fincube_auth', '1'); } catch (e) { /* ignore */ }
          (window).authSetSignedIn && (window).authSetSignedIn(true);
          closeAuthModal();
        } catch (err) {
          if (authLoading) authLoading.style.display = 'none';
          if (submitBtn) {
            submitBtn.disabled = false;
            submitBtn.style.opacity = '1';
            submitBtn.textContent = 'Sign In';
          }
          alert(err && err.message ? err.message : 'Network error during login');
        }
      })();
      
      // Original API code (commented out for demo)
      // In a real application, uncomment this and remove the setTimeout demo code above
      /* 
      fetch(`${API_BASE}/api/users/login`, {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
          'Accept': 'application/json',
          'X-CSRFTOKEN': getCsrfToken()
        },
        credentials: 'include',
        body: JSON.stringify(loginPayload)
      }).then(async (res) => {
        if (!res.ok) {
          const msg = await parseApiError(res);
          throw new Error(msg || 'Login failed');
        }
        return res.json().catch(() => ({}));
      }).then(() => {
        (window).authSetSignedIn && (window).authSetSignedIn(true);
        closeAuthModal();
      }).catch((err) => {
        alert(err.message || 'Login failed');
      }); 
      */
    }
  });

  

  formRegister && formRegister.addEventListener('submit', (e) => {
    e.preventDefault();
    const first = document.getElementById('reg-first');
    const last = document.getElementById('reg-last');
    const phone = document.getElementById('reg-phone');
    const email = document.getElementById('reg-email');
    const pass = document.getElementById('reg-password');
    const confirm = document.getElementById('reg-confirm');
    const firstErr = document.getElementById('reg-first-err');
    const lastErr = document.getElementById('reg-last-err');
    const phoneErr = document.getElementById('reg-phone-err');
    const emailErr = document.getElementById('reg-email-err');
    const passErr = document.getElementById('reg-password-err');
    let ok = true;
    if (first && first.value.trim() === '') { show(firstErr); ok = false; } else { hide(firstErr); }
    if (last && last.value.trim() === '') { show(lastErr); ok = false; } else { hide(lastErr); }
    // Strict phone parsing via libphonenumber-js
    let parsedE164 = '';
    if (phone) {
      try {
        const pn = window.libphonenumber.parsePhoneNumber(phone.value, 'BD');
        if (pn && pn.isValid()) {
          parsedE164 = pn.number; // E.164 like +8801XXXXXXXXX
          hide(phoneErr);
        } else {
          show(phoneErr); ok = false;
        }
      } catch (_) {
        show(phoneErr); ok = false;
      }
    }
    if (email && !/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email.value)) { show(emailErr); ok = false; } else { hide(emailErr); }
    if (pass && confirm && (pass.value.length < 6 || pass.value !== confirm.value)) { show(passErr); ok = false; } else { hide(passErr); }
    if (ok) {
      // Call backend registration
      const phoneRaw = parsedE164 || String(phone.value || '').trim();
      const registerPayload = {
        email: String(email.value || '').trim(),
        first_name: String(first.value || '').trim(),
        last_name: String(last.value || '').trim(),
        contact_number: phoneRaw,
        password: String(pass.value || ''),
        password_confirm: String(confirm.value || '')
      };
      fetch(`${API_BASE}/api/users/register`, {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
          'Accept': 'application/json',
          'X-CSRFTOKEN': getCsrfToken()
        },
        credentials: 'include',
        body: JSON.stringify(registerPayload)
      }).then(async (res) => {
        if (!res.ok) {
          const msg = await parseApiError(res);
          throw new Error(msg || 'Registration failed');
        }
        return res.json().catch(() => ({}));
      }).then(() => {
        if (window.Swal) {
          window.Swal.fire({ icon: 'success', title: 'Registration successful', text: 'Please login to continue' }).then(() => {
            const tabLogin = document.getElementById('tab-login');
            tabLogin && tabLogin.click();
          });
        } else {
          alert('Registration successful. Please login.');
          const tabLogin = document.getElementById('tab-login');
          tabLogin && tabLogin.click();
        }
      }).catch((err) => {
        const message = err.message || 'Registration failed';
        if (window.Swal) {
          window.Swal.fire({ icon: 'error', title: 'Registration failed', text: message });
        } else {
          alert(message);
        }
      });
    }
  });
</script>
